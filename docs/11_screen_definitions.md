# 11. 화면정의서 (Screen Definitions)

## 화면 맵 (Sitemap)

```
/                           # 랜딩 페이지
/sign-in                    # 로그인 (Clerk)
/proof/[token]              # 증빙 업로드 (공개)
/p/[token]                  # 공개 증빙 확인

/app                        # 대시보드
/app/onboarding             # 조직 선택/생성
/app/orders                 # 주문 목록
/app/orders/new             # 주문 생성
/app/orders/[id]            # 주문 상세
/app/labels                 # 라벨 인쇄
/app/notifications          # 알림 모니터링 (신규)
/app/orgs                   # 조직 관리
/app/settings/branding      # 브랜딩 설정
/app/settings/messaging     # 메시지 설정
```

---

## 1. 공개 페이지

### 1.1 랜딩 페이지 (`/`)

| 항목 | 내용 |
|------|------|
| 목적 | 서비스 소개 및 백오피스 진입점 |
| 인증 | 불필요 |
| 상태 | ✓ 구현됨 |

**UI 구성:**
- 서비스 타이틀 + 태그라인
- 가치제안 카드 3개 (현장/구매자/업체)
- CTA 버튼 → `/app`

---

### 1.2 증빙 업로드 (`/proof/[token]`)

| 항목 | 내용 |
|------|------|
| 목적 | QR 스캔 후 30초 컷 사진 업로드 |
| 인증 | 불필요 (토큰 기반) |
| 상태 | ✓ 구현됨 / MVP 개선 필요 |

**UI 구성:**
```
+------------------------------------------+
| [로고]  조직명                            |
+------------------------------------------+
| 주문번호: ORD-001                         |
| 컨텍스트: 근조화환                         |
+------------------------------------------+
| [수선 전] [수선 후] ← 탭 또는 단계         |
+------------------------------------------+
|                                          |
|     +------------------------+           |
|     |                        |           |
|     |    [카메라 아이콘]      |           |
|     |    촬영하기             |           |
|     |                        |           |
|     +------------------------+           |
|                                          |
+------------------------------------------+
| 업로드 진행률 표시 (개선)                  |
+------------------------------------------+
```

**MVP 개선사항:**
1. **오프라인 재시도**: 업로드 실패 시 LocalStorage 저장 → 재접속 시 복구
2. **카메라 권한 안내**: 권한 거부 시 설정 이동 가이드
3. **진행률 표시**: 업로드 중 percentage 또는 progress bar

**상태 흐름:**
```
idle → capturing → previewing → uploading
                                    ↓
                         success ←── error
                                      ↓
                              offline_saved
                                      ↓
                                 retrying
```

**API:**
- `GET /public/order/{token}` - 주문 정보 조회
- `POST /public/proof/{token}/upload` - 사진 업로드

---

### 1.3 공개 증빙 확인 (`/p/[token]`)

| 항목 | 내용 |
|------|------|
| 목적 | 로그인 없이 증빙 사진 확인 |
| 인증 | 불필요 (토큰 기반) |
| 상태 | ✓ 구현됨 |

**UI 구성:**
```
+------------------------------------------+
| [로고]  조직명           [수선 완료] 배지  |
+------------------------------------------+
| 주문번호: ORD-001                         |
| 컨텍스트: 가죽 가방 손잡이 수선             |
| 업로드: 2025-01-15 14:32                  |
+------------------------------------------+
| 자산 정보 (Asset Passport)                |
| 브랜드: Louis Vuitton                     |
| 모델: Speedy 30                          |
| 소재: 모노그램 캔버스                      |
+------------------------------------------+
|                                          |
|  [Before/After 슬라이더]                  |
|                                          |
+------------------------------------------+
| [링크 복사]  [공유]                        |
+------------------------------------------+
| Powered by 새김 (옵션)                    |
+------------------------------------------+
```

**API:**
- `GET /public/proof/{token}` - 증빙 정보 조회

---

## 2. 관리자 페이지 (인증 필수)

### 2.1 대시보드 (`/app`)

| 항목 | 내용 |
|------|------|
| 목적 | 운영 현황 한눈에 파악 |
| 인증 | 필수 (Clerk) |
| 상태 | ✓ 구현됨 / MVP 개선 필요 |

**UI 구성:**
```
+------------------------------------------+
| 오늘 현황               [오늘 v] 날짜필터 |
+------------------------------------------+
| [전체 주문]  [증빙 대기]  [증빙 완료]  [알림 실패] |
|    45           12           31           2      |
+------------------------------------------+
| 최근 증빙 (5건)                           |
| ORD-001  수선 전/후  10:32  [확인→]       |
| ORD-002  수선 후    10:15  [확인→]        |
| ...                                       |
+------------------------------------------+
| 빠른 작업                                 |
| [새 주문]  [오늘 라벨]  [CSV 가져오기]     |
+------------------------------------------+
```

**MVP 개선사항:**
1. **날짜 필터**: 오늘/이번주/이번달/커스텀
2. **알림 실패 KPI**: 실패 건수 카드 추가
3. **최근 증빙 목록**: 최근 5건 표시

**API:**
- `GET /admin/dashboard?start_date=&end_date=` (신규)

---

### 2.2 주문 목록 (`/app/orders`)

| 항목 | 내용 |
|------|------|
| 목적 | 주문 관리 및 검색 |
| 인증 | 필수 |
| 상태 | ✓ 구현됨 / MVP 개선 필요 |

**UI 구성:**
```
+------------------------------------------+
| 주문 관리                                 |
+------------------------------------------+
| [조직 v] [상태 v] [날짜 v] [검색...]       |
+------------------------------------------+
| [CSV 가져오기] [샘플 다운로드] [라벨 출력]   |
+------------------------------------------+
| □ | ID | 주문번호 | 발주자 | 수령인 | 상태 | 생성일 | 액션 |
|---|----|---------| -------|-------|------|-------|------|
| □ | 1  | ORD-001 | 홍길동  | 김철수 | 🟢완료| 01-15 | [상세]|
| □ | 2  | ORD-002 | 이영희  | -     | 🟡대기| 01-15 | [상세]|
+------------------------------------------+
| ◀ 1 2 3 ... 10 ▶        50건씩 / 총 245건 |
+------------------------------------------+
```

**MVP 개선사항:**
1. **페이지네이션**: 50건 단위
2. **날짜 필터**: 날짜 범위 선택기
3. **상태 뱃지 색상**: PENDING(노랑), TOKEN_ISSUED(파랑), PROOF_UPLOADED(녹색)

**API 수정:**
- `GET /admin/orders?page=&limit=&start_date=&end_date=&status=&q=`

---

### 2.3 주문 생성 (`/app/orders/new`)

| 항목 | 내용 |
|------|------|
| 목적 | 신규 주문 등록 |
| 인증 | 필수 |
| 상태 | ✓ 구현됨 |

**UI 구성:**
```
+------------------------------------------+
| 새 주문 등록                              |
+------------------------------------------+
| 조직: [선택 v]                            |
+------------------------------------------+
| 주문번호*: [____________]                  |
| 컨텍스트:  [____________]                  |
+------------------------------------------+
| 발주자 정보                               |
| 이름*:     [____________]                  |
| 전화번호*: [+82 10-____-____]              |
+------------------------------------------+
| 수령인 정보                               |
| 이름:      [____________]                  |
| 전화번호:  [+82 10-____-____]              |
+------------------------------------------+
|                          [취소] [등록]    |
+------------------------------------------+
```

**API:**
- `POST /admin/orders`

---

### 2.4 주문 상세 (`/app/orders/[id]`)

| 항목 | 내용 |
|------|------|
| 목적 | 주문 정보 확인, QR/증빙 관리 |
| 인증 | 필수 |
| 상태 | ✓ 구현됨 / MVP 개선 필요 |

**UI 구성:**
```
+------------------------------------------+
| 주문 상세 #ORD-001        [수정] [삭제]   |
+------------------------------------------+
| 기본 정보                                 |
| 주문번호: ORD-001                         |
| 컨텍스트: 근조화환                         |
| 발주자: 홍길동 (010-****-1234)             |
| 수령인: 김철수 (010-****-5678)             |
+------------------------------------------+
| QR 토큰 관리                              |
| 토큰: abc123...                           |
| [발급] [교체] [업로드 링크 복사] [QR 보기]  |
+------------------------------------------+
| 증빙 현황                                 |
| +--------+  +--------+                    |
| | Before |  | After  |                    |
| | [사진] |  | [사진] |                    |
| +--------+  +--------+                    |
| 업로드: 2025-01-15 14:32                  |
| [알림 재발송]                             |
+------------------------------------------+
| 발송 로그 (최근 20건)                     |
| 시간    | 대상   | 채널   | 상태  | 에러  |
| 14:32   | 발주자 | 알림톡 | 성공  | -     |
| 14:32   | 수령인 | SMS   | 실패  | timeout|
+------------------------------------------+
| [라벨 인쇄]  [새로고침]                    |
+------------------------------------------+
```

**MVP 개선사항:**
1. **수정 기능**: 주문 정보 수정 모달
2. **삭제 기능**: soft delete + 확인 다이얼로그

**API 추가:**
- `PATCH /admin/orders/{id}` (신규)
- `DELETE /admin/orders/{id}` (신규)

---

### 2.5 알림 모니터링 (`/app/notifications`) - 신규

| 항목 | 내용 |
|------|------|
| 목적 | 알림 발송 현황 모니터링, 실패 건 재발송 |
| 인증 | 필수 |
| 상태 | 🆕 신규 구현 |

**UI 구성:**
```
+------------------------------------------+
| 알림 현황                                 |
+------------------------------------------+
| [오늘 v] [상태 v] [채널 v]                 |
+------------------------------------------+
| 집계: 성공 45건 / 실패 3건 / 대기 2건      |
+------------------------------------------+
| 시간  | 주문번호 | 대상   | 채널   | 상태  | 액션   |
|-------|---------|--------|--------|-------|--------|
| 14:32 | ORD-001 | 발주자 | 알림톡 | 🟢성공 | -      |
| 14:30 | ORD-002 | 수령인 | SMS   | 🔴실패 | [재발송]|
| 14:28 | ORD-003 | 발주자 | 알림톡 | 🟡대기 | -      |
+------------------------------------------+
| ◀ 1 2 3 ▶                                |
+------------------------------------------+
```

**필터:**
- 날짜: 오늘/어제/최근 7일/커스텀
- 상태: 전체/성공/실패/대기
- 채널: 전체/알림톡/SMS

**API:**
- `GET /admin/notifications?page=&status=&channel=&start_date=&end_date=` (신규)

---

### 2.6 라벨 인쇄 (`/app/labels`)

| 항목 | 내용 |
|------|------|
| 목적 | QR 라벨 생성 및 인쇄 |
| 인증 | 필수 |
| 상태 | ✓ 구현됨 |

**모드:**
- 특정 주문: `?ids=1,2,3`
- 오늘 주문: `?mode=today`
- 특정 날짜: `?day=2025-01-15`

**템플릿:**
- A4 10칸 (2×5)
- A4 12칸 (2×6) - 기본
- A4 14칸 (2×7)

**옵션:**
- 재단선 표시
- 미니 라벨 모드
- 자동 인쇄

---

### 2.7 브랜딩 설정 (`/app/settings/branding`)

| 항목 | 내용 |
|------|------|
| 목적 | 공개 페이지 화이트라벨 설정 |
| 인증 | 필수 (관리자) |
| 상태 | ✓ 구현됨 |

**설정 항목:**
- 공개 표시 이름
- 공개 로고 URL
- 커스텀 도메인 (v2)
- "Powered by 새김" 숨김

---

### 2.8 메시지 설정 (`/app/settings/messaging`)

| 항목 | 내용 |
|------|------|
| 목적 | 알림톡/SMS 템플릿 커스터마이징 |
| 인증 | 필수 (관리자) |
| 상태 | ✓ 구현됨 |

**설정 항목:**
- 알림톡 템플릿 코드
- 알림톡 문구 (발주자/수령자)
- SMS 문구 (발주자/수령자)
- SMS 폴백 활성화

**치환 변수:**
- `{brand}`, `{url}`, `{order}`, `{context}`, `{sender}`, `{recipient}`

---

## 3. 공통 컴포넌트

### 3.1 AdminLayout
- 탑바: 로고, 네비게이션, 사용자 메뉴
- 네비게이션: 대시보드, 주문, **알림(신규)**, 조직, 설정
- 조직 가드: 조직 미선택 시 온보딩으로 리다이렉트

### 3.2 UploadForm
- ProofType 선택 (BEFORE/AFTER)
- 파일 선택/카메라 캡처
- 미리보기
- 업로드 진행률
- 오프라인 저장/재시도 (MVP 개선)

### 3.3 BeforeAfterSlider
- 수선 전/후 이미지 비교
- 드래그 슬라이더

---

## 4. MVP 필수 구현 항목 체크리스트

### 프론트엔드
- [ ] 증빙 업로드 오프라인 재시도
- [ ] 증빙 업로드 카메라 권한 안내
- [ ] 대시보드 날짜 필터
- [ ] 대시보드 알림 실패 KPI
- [ ] 주문 목록 페이지네이션
- [ ] 주문 목록 날짜 필터
- [ ] 주문 상세 수정 기능
- [ ] 주문 상세 삭제 기능
- [ ] 알림 모니터링 화면 신규

### 백엔드 API
- [ ] `GET /admin/dashboard?start_date=&end_date=`
- [ ] `PATCH /admin/orders/{id}`
- [ ] `DELETE /admin/orders/{id}`
- [ ] `GET /admin/notifications?page=&status=&channel=&start_date=&end_date=`

### 네비게이션
- [ ] AdminLayout에 알림 메뉴 추가

---

## 5. Nice-to-have (v1.5+)

| 화면 | 기능 |
|------|------|
| `/app/analytics` | 분석/리포트 대시보드 |
| `/partner/[org_code]` | 파트너 PIN 모드 |
| `/p/[token]/print` | 증빙서 인쇄 |
| 주문 목록 | 벌크 알림 발송 |
| 공개 증빙 | 이미지 확대 (Lightbox) |
| 브랜딩 설정 | 로고 파일 업로드 |
| 메시지 설정 | 테스트 발송 |
